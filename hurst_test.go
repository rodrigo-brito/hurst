package hurst

import (
	"testing"

	"github.com/stretchr/testify/require"
)

func TestHurst(t *testing.T) {
	tt := []struct {
		input []float64
		want  float64
		name  string
	}{
		{
			input: []float64{
				1., 1.00666667, 1.02, 1.04, 1.06666667,
				1.1, 1.14, 1.18666667, 1.24, 1.3,
				1.36666667, 1.44, 1.52, 1.60666667, 1.7,
				1.8, 1.90666667, 2.02, 2.14, 2.26666667,
				2.4, 2.54, 2.68666667, 2.84, 3.,
				3.16666667, 3.34, 3.52, 3.70666667, 3.9,
				4.1, 4.30666667, 4.52, 4.74, 4.96666667,
				5.2, 5.44, 5.68666667, 5.94, 6.2,
				6.46666667, 6.74, 7.02, 7.30666667, 7.6,
				7.9, 8.20666667, 8.52, 8.84, 9.16666667,
				9.5, 9.84, 10.18666667, 10.54, 10.9,
				11.26666667, 11.64, 12.02, 12.40666667, 12.8,
				13.2, 13.60666667, 14.02, 14.44, 14.86666667,
				15.3, 15.74, 16.18666667, 16.64, 17.1,
				17.56666667, 18.04, 18.52, 19.00666667, 19.5,
				20., 20.50666667, 21.02, 21.54, 22.06666667,
				22.6, 23.14, 23.68666667, 24.24, 24.8,
				25.36666667, 25.94, 26.52, 27.10666667, 27.7,
				28.3, 28.90666667, 29.52, 30.14, 30.76666667,
				31.4, 32.04, 32.68666667, 33.34, 34.,
				34.66666667, 35.34, 36.02, 36.70666667, 37.4,
				38.1, 38.80666667, 39.52, 40.24, 40.96666667,
				41.7, 42.44, 43.18666667, 43.94, 44.7,
				45.46666667, 46.24, 47.02, 47.80666667, 48.6,
				49.4, 50.20666667, 51.02, 51.84, 52.66666667,
				53.5, 54.34, 55.18666667, 56.04, 56.9,
				57.76666667, 58.64, 59.52, 60.40666667, 61.3,
				62.2, 63.10666667, 64.02, 64.94, 65.86666667,
				66.8, 67.74, 68.68666667, 69.64, 70.6,
				71.56666667, 72.54, 73.52, 74.50666667, 75.5,
			},
			want: 0.689,
			name: "trend",
		},
		{
			input: []float64{
				0.41127837, -0.79229647, -1.63494472, -1.55443424, -1.17259725,
				-1.97417822, -2.89219743, -2.7407428, -3.05943788, -1.54490705,
				-1.60518375, -1.6478396, -1.50874029, -2.1725433, -2.35251109,
				-2.49089935, -2.914663, -1.8068485, -2.65149596, -4.57034042,
				-5.32152365, -5.32738535, -4.58784498, -4.93682233, -5.43806994,
				-5.2088629, -4.54002078, -2.89371573, -3.46367157, -4.85151032,
				-3.93108039, -5.02750265, -7.13191592, -6.77436437, -6.8246809,
				-6.75298714, -5.41769544, -5.77123012, -6.13745637, -5.43831267,
				-5.03633605, -4.15628438, -4.65194487, -2.35407333, -0.87769675,
				-0.48584669, -0.22524822, -0.93979765, -1.30338257, -1.04531233,
				-2.04849757, -3.05471798, -3.43694044, -4.82857511, -4.06971391,
				-3.43671199, -1.78947456, -0.26913124, 0.64709739, 1.49983795,
				1.10146577, 0.98828381, -1.29548887, -1.80346471, -1.05804687,
				-1.60607082, -1.54164123, -0.82686344, -2.20561639, -3.26617552,
				-5.64514525, -6.31780534, -6.5766068, -5.48214476, -4.61357793,
				-4.40602104, -2.60593336, -2.2167483, -2.73153652, -2.91603751,
				-2.52848326, -1.81212393, -2.61803012, -3.57477843, -2.94355546,
				-2.26412641, -0.7975775, -0.74563492, -0.92324191, -0.28694775,
				-2.22569995, -2.47186297, -2.31794553, -2.97006305, -4.00904219,
				-4.71950001, -5.19053092, -4.50981723, -4.74739763, -5.00286042,
				-5.23287025, -4.47098938, -7.61349994, -6.01071426, -6.72782205,
				-6.55020014, -7.08667277, -5.45144343, -3.83550889, -5.27626571,
				-3.83018509, -4.59006937, -5.33095924, -4.71393086, -5.69622116,
				-3.98738564, -3.46450711, -4.86866523, -4.72939228, -4.35021082,
				-5.63618708, -5.24477979, -5.35516548, -4.93258658, -4.29441486,
				-2.45694669, -2.39165207, -1.96494408, -1.66227288, -0.85717634,
				-0.26119581, -2.84229508, -1.2786854, -3.3474757, -5.58872848,
				-5.30265664, -5.30316438, -4.14597555, -2.83500728, -1.99963154,
				-2.3501954, -3.13294066, -1.75842298, -1.04697093, -0.58249998,
				0.73893807, 0.49798024, 0.38132266, -0.30844303, -0.33041885,
			},
			want: 0.01,
			name: "random",
		},
	}

	for _, tc := range tt {
		t.Run(tc.name, func(t *testing.T) {
			hurst := Estimate(tc.input, 2, 100)
			require.InDelta(t, tc.want, hurst, 0.001)
		})
	}
}
